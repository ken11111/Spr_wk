# Claude Code効果的プロンプト集

## 概要

このディレクトリには、Spresense SDK開発でClaude Codeを効果的に活用するためのプロンプト例をまとめています。

実際のBMI160姿勢推定アプリケーション開発プロジェクト（2日間で完結）で使用し、効果が実証されたプロンプトです。

## プロンプトファイル一覧

### 📄 AUTOMATION_STRATEGY.md ⭐NEW
**スクリプト自動化 × AIプロンプト ハイブリッド効率化戦略**

- トークン消費を最小化する自動化戦略
- Phase別の最適なスクリプト活用法
- 実際に使えるスクリプト例
- AI対話とスクリプトの使い分け指針

**効果**: トークン86%削減、時間72%短縮
**難易度**: ★★☆☆☆

---

### 📄 01_environment_check.md
**フェーズ1: 最新環境の確認と構築**

- SDK v3.0.0 → v3.4.5へのアップデート
- ツールチェーンのインストール
- ビルド環境の構築と確認

**想定時間**: 1-2時間
**難易度**: ★☆☆☆☆

### 📄 02_build_system_integration.md
**フェーズ2: NuttXビルドシステムへの統合**

- アプリケーションのbuiltin登録
- Kconfig/Makefile/Make.defsの作成
- .config二重構造の理解と対処
- デバッグとトラブルシューティング

**想定時間**: 2-4時間
**難易度**: ★★★★★（最も難しい）

### 📄 03_application_development.md
**フェーズ3: アプリケーションの提案から実装**

- 要件定義とアーキテクチャ設計
- センサーデータ取得
- Madgwick AHRS統合
- 位置推定の実装

**想定時間**: 3-5時間
**難易度**: ★★★☆☆

## 使い方

### 基本的な進め方

```mermaid
Phase 1 → Phase 2 → Phase 3
環境構築 → ビルド統合 → アプリ実装
(1-2h)   (2-4h)    (3-5h)
```

1. **Phase 1から順番に進める**: 環境が整っていないと後の作業ができません
2. **各プロンプトをコピー&ペースト**: そのまま使うか、状況に合わせて修正
3. **結果を確認してから次へ**: 焦らず、一つずつ確認しながら進める
4. **エラーは詳細に共有**: エラーメッセージは省略せず全文をClaude Codeに伝える

### プロンプトのカスタマイズ方法

各プロンプトの【】で囲まれた部分を、自分の環境に合わせて変更してください。

```
【環境情報】
- 作業ディレクトリ: ~/Spr_ws/spresense/  ← 自分のパスに変更
- OS: WSL2 (Ubuntu on Windows 11)        ← 自分の環境に変更
```

### 効果的なプロンプトの3原則

1. **具体的に**: 曖昧な指示ではなく、具体的な情報を含める
   - ❌ 「うまくいきません」
   - ✅ 「ビルドは成功しますが、NuttShellで実行すると'command not found'エラーが出ます」

2. **段階的に**: 一度に全てを解決しようとせず、1ステップずつ
   - ❌ 「環境構築からアプリ実装まで全部やって」
   - ✅ 「まず現在のSDKバージョンを確認してください」

3. **コンテキストを共有**: Claude Codeに現状を理解させる
   - ❌ 「エラーが出ました」
   - ✅ 「以下のコマンドを実行したところ、このエラーが出ました: [コマンドとエラー全文]」

## フェーズ別の重要ポイント

### Phase 1: 環境構築
✅ **成功の鍵**: ARM GCCのパス設定、サブモジュール更新の確認
⚠️ **よくある失敗**: サブモジュール更新の失敗、ツールチェーンが見つからない

**推奨プロンプト戦略**:
```
1. 現状診断を依頼
2. 段階的なアップデート手順を取得
3. 各ステップ後に成功確認
4. ビルドテストで環境確認
```

### Phase 2: ビルドシステム統合（最難関）
✅ **成功の鍵**: .configの二重構造理解、既存アプリとの比較
⚠️ **よくある失敗**: SDK側.configのみ設定、CONFIG変数名の誤り

**推奨プロンプト戦略**:
```
1. まず仕組みを理解する質問から
2. 既存の動作例（sixaxis）を参照させる
3. .configファイルを全て探索させる
4. 段階的にデバッグ（一度に全て疑わない）
```

**最重要ポイント**:
```bash
# このコマンドでCONFIGURED_APPSを確認させる
make --dry-run -p 2>&1 | grep CONFIGURED_APPS
```

### Phase 3: アプリケーション実装
✅ **成功の鍵**: モジュール分割、既存ライブラリ活用、適切なエラーハンドリング
⚠️ **よくある失敗**: メモリ不足、単位変換ミス、タイミング制御の誤り

**推奨プロンプト戦略**:
```
1. 要件整理と技術選定をAIに相談
2. アーキテクチャ設計を先に行う
3. モジュール単位で実装（一度に全てではない）
4. 実装後は必ずコードレビューを依頼
```

## プロンプトテンプレート

### 問題発生時の基本テンプレート

```
【状況】
- フェーズ: [Phase 1/2/3]
- 実行したコマンド: [コマンド]
- 期待した結果: [期待していたこと]
- 実際の結果: [実際に起きたこと]

【エラーメッセージ】
[エラーメッセージ全文]

【確認済み事項】
- [確認した内容1]
- [確認した内容2]

【質問】
1. このエラーの原因は何ですか？
2. 解決するための手順を教えてください
3. 類似の問題を避けるための対策はありますか？

段階的に調査・解決できるように提案してください。
```

### コード実装依頼の基本テンプレート

```
【実装したい機能】
[機能の説明]

【技術的要件】
- 使用ライブラリ: [ライブラリ名]
- パフォーマンス要件: [要件]
- メモリ制約: [制約]

【質問】
1. 実装方針として考えられるアプローチは？
2. 推奨されるデザインパターンは？
3. 注意すべきポイントは？

【依頼】
以下を実装してください：
- [ファイル名]: [機能説明]

コメントで処理内容を説明してください。
NuttX/Spresenseのベストプラクティスに従ってください。
```

## 実際の成果

このプロンプト集を使用した実際のプロジェクトでは：

| 項目 | 従来の推定時間 | AI活用時間 | 効率化 |
|------|---------------|-----------|--------|
| Phase 1: 環境構築 | 4-6時間 | 1時間 | **5倍** |
| Phase 2: ビルド統合 | 6-8時間 | 2時間 | **4倍** |
| Phase 3: アプリ実装 | 8-12時間 | 3時間 | **3倍** |
| ドキュメント作成 | 6-8時間 | 0.5時間 | **12倍** |
| **合計** | **24-34時間** | **6.5時間** | **約4倍** |

**実質1日分の作業時間**で、1週間程度かかる作業を完了できました。

## トラブルシューティング

### Q1: Claude Codeが意図しない提案をする

**A**: プロンプトに具体的な制約を追加してください。

```
【制約】
- 既存のsixaxisアプリの実装パターンに従ってください
- CONFIG変数は必ずCONFIG_EXAMPLES_*プレフィックスを使用
- MODULE変数は使用しないでください
```

### Q2: エラーの原因がわからない

**A**: 以下のプロンプトで段階的調査を依頼：

```
以下のエラーが発生しました: [エラー]

段階的に原因を調査したいです。
優先度の高い調査項目から順に、確認すべきコマンドを提案してください。
各調査の結果を報告するので、次の調査項目を指示してください。
```

### Q3: Claude Codeの提案が古い情報に基づいている

**A**: SDK/NuttXのバージョンを明示してください。

```
Spresense SDK v3.4.5 (NuttX 12.3.0) での実装方法を教えてください。
古いバージョンの情報ではなく、最新の推奨方法をお願いします。

既存の動作例として、sdk/apps/examples/sixaxis/ を参照してください。
```

## さらなる学習リソース

### 公式ドキュメント
- [Spresense SDK セットアップガイド](https://developer.sony.com/spresense/development-guides/sdk_set_up_ide_ja)
- [NuttX Documentation](https://nuttx.apache.org/docs/latest/)

### 本プロジェクトのドキュメント
- [README.md](../README.md) - プロジェクト全体概要
- [SUCCESS_SUMMARY.md](../SUCCESS_SUMMARY.md) - 完了報告書
- [ISSUE_RESOLVED.md](../ISSUE_RESOLVED.md) - 問題解決記録
- [COMMANDS_SUMMARY.md](../COMMANDS_SUMMARY.md) - コマンドリファレンス

## フィードバック

これらのプロンプトを使用して、改善提案や成功例がありましたら、ぜひ共有してください。

## ライセンス

このプロンプト集は、Spresense開発コミュニティのために作成されました。
自由に使用・改変・共有していただいて構いません。

---

**作成日**: 2025-12-14
**対象**: Spresense SDK v3.4.5開発者
**AI**: Claude Code (Claude Sonnet 4.5)
**プロジェクト期間**: 2日間（実質6.5時間）
