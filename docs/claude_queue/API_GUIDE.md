# Claude API å®Œå…¨è‡ªå‹•å®Ÿè¡Œã‚¬ã‚¤ãƒ‰

## ğŸ¯ æ¦‚è¦

Anthropic APIã‚’ä½¿ç”¨ã—ãŸ**å®Œå…¨è‡ªå‹•å®Ÿè¡Œç‰ˆ**ã®ã‚­ãƒ¥ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

**ä¸»ãªç‰¹å¾´**:
- âœ… **å®Œå…¨è‡ªå‹•**: äººã®ä»‹å…¥ãªã—ã§ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
- âœ… **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ**: Cronã§æŒ‡å®šæ™‚åˆ»ãƒ»é–“éš”ã§è‡ªå‹•å®Ÿè¡Œ
- âœ… **ä½¿ç”¨é‡åˆ¶é™å¯¾å¿œ**: APIåˆ¶é™æ™‚ã¯è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤
- âœ… **ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿æ›¸ã**: ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œãŒå¯èƒ½
- âœ… **å®Ÿè¡Œçµæœä¿å­˜**: å…¨ã¦ã®å‡ºåŠ›ã‚’è‡ªå‹•ä¿å­˜

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd /home/ken/Spr_ws/claude_queue
./setup_api.sh
```

**å¯¾è©±å¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**:
1. Pythonç’°å¢ƒãƒã‚§ãƒƒã‚¯
2. anthropic ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. APIã‚­ãƒ¼ã®è¨­å®š
4. å®Ÿè¡Œæ¨©é™ã®è¨­å®š

### 2. APIã‚­ãƒ¼å–å¾—

1. [Anthropic Console](https://console.anthropic.com/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ/ãƒ­ã‚°ã‚¤ãƒ³
3. API Keysã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§æ–°ã—ã„ã‚­ãƒ¼ã‚’ä½œæˆ
4. ã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼

### 3. APIã‚­ãƒ¼è¨­å®š

**æ–¹æ³•1: ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ¨å¥¨ï¼‰**
```bash
./setup_api.sh
# â†’ APIã‚­ãƒ¼å…¥åŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã‚­ãƒ¼ã‚’å…¥åŠ›
```

**æ–¹æ³•2: .env ãƒ•ã‚¡ã‚¤ãƒ«**
```bash
echo 'ANTHROPIC_API_KEY=your-api-key-here' > .env
```

**æ–¹æ³•3: ç’°å¢ƒå¤‰æ•°**
```bash
export ANTHROPIC_API_KEY='your-api-key-here'
```

**æ–¹æ³•4: config.json**
```bash
echo '{"api_key": "your-api-key-here"}' > config.json
```

### 4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# æ¬¡ã®ã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•å®Ÿè¡Œ
./queue_manager_v2.sh run
```

**å‡ºåŠ›ä¾‹**:
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ ã‚¿ã‚¹ã‚¯å®Ÿè¡Œé–‹å§‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ID: 5
å„ªå…ˆåº¦: medium
ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: /home/ken/Spr_ws
ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: "PATENT_ANALYSIS.mdã‚’èª­ã‚“ã§å¼ç†å£«ã®è¦–ç‚¹ã§è©•ä¾¡..."

ğŸ¤– Claude APIå®Ÿè¡Œ

ã‚¿ã‚¹ã‚¯ID: 5
ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: /home/ken/Spr_ws
ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: PATENT_ANALYSIS.mdã‚’èª­ã‚“ã§å¼ç†å£«ã®è¦–ç‚¹ã§è©•ä¾¡...

ğŸ¤– Claude APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ä¸­...
   ãƒ¢ãƒ‡ãƒ«: claude-sonnet-4-5-20250929
   ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: /home/ken/Spr_ws

âœ… å®Ÿè¡Œå®Œäº†
   å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³: 1,234
   å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³: 2,345
   åˆè¨ˆãƒˆãƒ¼ã‚¯ãƒ³: 3,579

ğŸ“„ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«: state/outputs/task_5_20251214_190530.txt

âœ… æ­£å¸¸çµ‚äº†

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… ã‚¿ã‚¹ã‚¯å®Œäº† (å®Ÿè¡Œæ™‚é–“: 15ç§’)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### 5. å®Ÿè¡Œçµæœã®ç¢ºèª

```bash
# æœ€æ–°ã®å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
ls -ltr state/outputs/task_*.txt | tail -1

# å†…å®¹ã‚’è¡¨ç¤º
cat state/outputs/task_5_20251214_190530.txt
```

## ğŸ“Š APIä½¿ç”¨æ–™é‡‘

Claude APIã¯å¾“é‡èª²é‡‘åˆ¶ã§ã™ã€‚

### æ–™é‡‘ï¼ˆ2025å¹´12æœˆæ™‚ç‚¹ï¼‰

**Claude Sonnet 4.5** (ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«):
- å…¥åŠ›: $3.00 / 1M tokens
- å‡ºåŠ›: $15.00 / 1M tokens

### æ¦‚ç®—ã‚³ã‚¹ãƒˆ

**å…¸å‹çš„ãªã‚¿ã‚¹ã‚¯**:
- å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³: 1,000 tokens = $0.003
- å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³: 2,000 tokens = $0.030
- **åˆè¨ˆ: ç´„$0.033ï¼ˆç´„5å††ï¼‰**

**1æ—¥10ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ**:
- ç´„$0.33/æ—¥ = ç´„50å††/æ—¥
- ç´„$10/æœˆ = ç´„1,500å††/æœˆ

### ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãƒ’ãƒ³ãƒˆ

1. **max_tokensã‚’èª¿æ•´**: çŸ­ã„å›ç­”ã§ååˆ†ãªã‚‰ `max_tokens` ã‚’æ¸›ã‚‰ã™
2. **ãƒãƒƒãƒå‡¦ç†**: é–¢é€£ã‚¿ã‚¹ã‚¯ã‚’ã¾ã¨ã‚ã¦å®Ÿè¡Œ
3. **Haikuä½¿ç”¨**: ç°¡å˜ãªã‚¿ã‚¹ã‚¯ã¯ Claude Haiku (å®‰ä¾¡) ã‚’ä½¿ç”¨

## ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
claude_queue/
â”œâ”€â”€ claude_api_executor.py       # Python APIå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ claude_executor.sh           # Bashå®Ÿè¡Œãƒ©ãƒƒãƒ‘ãƒ¼
â”œâ”€â”€ queue_manager_v2.sh          # ã‚­ãƒ¥ãƒ¼ç®¡ç†
â”œâ”€â”€ prompts.csv                  # ã‚¿ã‚¹ã‚¯å®šç¾©
â”œâ”€â”€ .env                         # APIã‚­ãƒ¼ï¼ˆgitignoreæ¨å¥¨ï¼‰
â”œâ”€â”€ config.json                  # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”œâ”€â”€ setup_api.sh                 # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ state/
    â”œâ”€â”€ executed.log             # å®Ÿè¡Œå±¥æ­´
    â”œâ”€â”€ repeat_tasks.log         # ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯
    â”œâ”€â”€ quota_exceeded.log       # APIåˆ¶é™
    â””â”€â”€ outputs/
        â”œâ”€â”€ task_5_*.txt         # ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›
        â””â”€â”€ task_5_*.json        # JSONå‡ºåŠ›ï¼ˆè©³ç´°æƒ…å ±ï¼‰
```

### å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
1. queue_manager_v2.sh run
   â†“
2. prompts.csv ã‹ã‚‰æ¬¡ã®ã‚¿ã‚¹ã‚¯ã‚’å–å¾—
   â†“
3. claude_executor.sh ã‚’å‘¼ã³å‡ºã—
   â†“
4. claude_api_executor.py ã§APIå®Ÿè¡Œ
   â†“
5. Anthropic APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
   â†“
6. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ outputs/ ã«ä¿å­˜
   â†“
7. executed.log ã«è¨˜éŒ²
   â†“
8. å®Œäº†ï¼ˆæ¬¡ã®ã‚¿ã‚¹ã‚¯ã¸ï¼‰
```

## â° Cronã§è‡ªå‹•å®Ÿè¡Œ

### è¨­å®šæ–¹æ³•

```bash
./setup_cron.sh
```

ã¾ãŸã¯æ‰‹å‹•ã§è¨­å®š:

```bash
crontab -e

# ä»¥ä¸‹ã‚’è¿½åŠ ï¼ˆ30åˆ†ã”ã¨ï¼‰
*/30 * * * * cd /home/ken/Spr_ws/claude_queue && ./queue_manager_v2.sh run >> cron.log 2>&1
```

### Cronè¨­å®šä¾‹

```cron
# 30åˆ†ã”ã¨ï¼ˆæ¨å¥¨ï¼‰
*/30 * * * * cd /home/ken/Spr_ws/claude_queue && ./queue_manager_v2.sh run >> cron.log 2>&1

# 1æ™‚é–“ã”ã¨
0 * * * * cd /home/ken/Spr_ws/claude_queue && ./queue_manager_v2.sh run >> cron.log 2>&1

# æ¯æ—¥9æ™‚
0 9 * * * cd /home/ken/Spr_ws/claude_queue && ./queue_manager_v2.sh run >> cron.log 2>&1

# å¹³æ—¥ã®9-18æ™‚ã€1æ™‚é–“ã”ã¨
0 9-18 * * 1-5 cd /home/ken/Spr_ws/claude_queue && ./queue_manager_v2.sh run >> cron.log 2>&1
```

## ğŸ“‹ ã‚¿ã‚¹ã‚¯å®šç¾©

### prompts.csv ã®ä¾‹

```csv
id,priority,working_dir,prompt,status,scheduled_time,dependencies,repeat,repeat_interval,retry_count,max_retries
1,high,/home/ken/Spr_ws,"README.mdã‚’èª­ã‚“ã§è¦ç´„ã—ã¦ãã ã•ã„",pending,,,no,,0,3
10,high,/home/ken/Spr_ws,"AIæŠ€è¡“ã®æœ€æ–°å‹•å‘ã‚’èª¿æŸ»",pending,,,yes,daily,0,5
20,medium,/home/ken/Spr_ws,"é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ",pending,2025-12-15 09:00,,yes,weekly,0,3
```

### ã‚«ãƒ©ãƒ èª¬æ˜

| ã‚«ãƒ©ãƒ  | èª¬æ˜ | ä¾‹ |
|--------|------|-----|
| id | ä¸€æ„ã®ã‚¿ã‚¹ã‚¯ID | 1, 10, 20 |
| priority | å„ªå…ˆåº¦ | high, medium, low |
| working_dir | ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | /home/ken/Spr_ws |
| prompt | APIã«é€ä¿¡ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ | "README.mdã‚’èª­ã‚“ã§è¦ç´„" |
| status | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | pending, completed |
| scheduled_time | å®Ÿè¡Œé–‹å§‹æ™‚åˆ» | 2025-12-15 09:00 |
| dependencies | ä¾å­˜ã‚¿ã‚¹ã‚¯ID | 10\|20 |
| repeat | ç¹°ã‚Šè¿”ã—å®Ÿè¡Œ | yes, no |
| repeat_interval | ç¹°ã‚Šè¿”ã—é–“éš” | daily, weekly, monthly |
| retry_count | ç¾åœ¨ã®ãƒªãƒˆãƒ©ã‚¤å›æ•° | 0 |
| max_retries | æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•° | 3, 5 |

## ğŸ›¡ï¸ APIåˆ¶é™å¯¾å¿œ

### ä½¿ç”¨é‡åˆ¶é™

Claude APIã«ã¯ä»¥ä¸‹ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™:
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: 1åˆ†ã‚ãŸã‚Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
- **ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™**: 1æ—¥ã‚ãŸã‚Šã®ãƒˆãƒ¼ã‚¯ãƒ³æ•°
- **åŒæ™‚å®Ÿè¡Œåˆ¶é™**: åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°

### åˆ¶é™åˆ°é”æ™‚ã®å‹•ä½œ

```
1. APIå®Ÿè¡Œ
   â†“
2. RateLimitErroræ¤œå‡º
   â†“
3. çµ‚äº†ã‚³ãƒ¼ãƒ‰2ã‚’è¿”ã™
   â†“
4. quota_exceeded.log ã«è¨˜éŒ²
   â†“
5. æ¬¡å›Cronå®Ÿè¡Œæ™‚ã«è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤
```

### ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥

**æ¨å¥¨è¨­å®š**:
- Croné–“éš”: 30åˆ†
- max_retries: 3-5å›

**å‹•ä½œä¾‹**:
```
10:00 - APIåˆ¶é™åˆ°é” â†’ ä¿ç•™
10:30 - ãƒªãƒˆãƒ©ã‚¤ï¼ˆã¾ã åˆ¶é™ä¸­ï¼‰
11:00 - ãƒªãƒˆãƒ©ã‚¤ï¼ˆæˆåŠŸï¼ï¼‰
```

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q1: APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼**:
```
âŒ ã‚¨ãƒ©ãƒ¼: APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“
```

**è§£æ±ºç­–**:
```bash
# .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
cat .env

# ãªã‘ã‚Œã°ä½œæˆ
echo 'ANTHROPIC_API_KEY=your-key' > .env

# ã¾ãŸã¯ setup_api.sh ã‚’å†å®Ÿè¡Œ
./setup_api.sh
```

### Q2: anthropic ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ã‚¨ãƒ©ãƒ¼**:
```
âŒ ã‚¨ãƒ©ãƒ¼: anthropic ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“
```

**è§£æ±ºç­–**:
```bash
pip3 install anthropic

# ã¾ãŸã¯
python3 -m pip install anthropic
```

### Q3: APIåˆ¶é™ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼**:
```
APIã‚¨ãƒ©ãƒ¼: Rate limit exceeded
```

**å¯¾å‡¦**:
- è‡ªå‹•çš„ã«ãƒªãƒˆãƒ©ã‚¤ã•ã‚Œã¾ã™
- é »åº¦ã‚’ä¸‹ã’ã‚‹å ´åˆã¯ Croné–“éš”ã‚’èª¿æ•´
- ä½¿ç”¨é‡ã‚’ç¢ºèª: https://console.anthropic.com/

### Q4: å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œãªã„

**ç¢ºèª**:
```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª
ls -la state/outputs/

# æ¨©é™ç¢ºèª
chmod 755 state/outputs/

# æœ€è¿‘ã®å®Ÿè¡Œãƒ­ã‚°
tail -20 state/execution.log
```

## ğŸ“Š ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### å®Ÿè¡ŒçŠ¶æ³ã®ç¢ºèª

```bash
# ã‚­ãƒ¥ãƒ¼çŠ¶æ…‹
./queue_manager_v2.sh status

# å®Ÿè¡Œå±¥æ­´
cat state/executed.log

# APIåˆ¶é™å±¥æ­´
cat state/quota_exceeded.log

# æœ€æ–°ã®å‡ºåŠ›
ls -ltr state/outputs/ | tail -5
```

### ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# é€±æ¬¡ã§ãƒ­ã‚°ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
0 0 * * 0 cd /home/ken/Spr_ws/claude_queue/state && tar -czf logs_$(date +\%Y\%m\%d).tar.gz *.log && rm *.log && touch executed.log repeat_tasks.log quota_exceeded.log retry_tasks.log
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### APIã‚­ãƒ¼ã®ä¿è­·

```bash
# .env ã‚’ .gitignore ã«è¿½åŠ 
echo '.env' >> .gitignore

# æ¨©é™ã‚’åˆ¶é™
chmod 600 .env

# ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ï¼ˆæ¨å¥¨ï¼‰
export ANTHROPIC_API_KEY='your-key'
```

### ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™

```bash
chmod 700 claude_queue/
chmod 600 .env
chmod 644 prompts.csv
chmod 755 *.sh
chmod 755 *.py
```

## ğŸ“š å‚è€ƒè³‡æ–™

- [Anthropic API Documentation](https://docs.anthropic.com/)
- [Claude Models](https://docs.anthropic.com/claude/docs/models-overview)
- [API Pricing](https://www.anthropic.com/pricing)
- [Rate Limits](https://docs.anthropic.com/claude/reference/rate-limits)

---

**ä½œæˆæ—¥**: 2025-12-14
**å¯¾è±¡**: Claude APIè‡ªå‹•å®Ÿè¡Œã‚­ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
**ç›®çš„**: å®Œå…¨è‡ªå‹•å®Ÿè¡Œã®è¨­å®šã‚¬ã‚¤ãƒ‰
